# 文件读写案例

## 1. 核心概念
- 定义：实现C++中文件的读取、写入、追加等基本操作
- 关键特性：文本文件操作、二进制文件操作、文件流状态管理

## 2. 语法规则
- 基本语法：使用fstream、ifstream、ofstream类进行文件操作
- 代码示例：
```cpp
#include <iostream>
#include <fstream>
#include <string>
#include <vector>

class FileHandler {
public:
    // 写入文本文件
    static void writeTextFile(const std::string& filename, const std::string& content) {
        std::ofstream file(filename);
        if (!file) {
            std::cout << "文件创建失败: " << filename << std::endl;
            return;
        }
        
        file << content;
        file.close();
        std::cout << "文件写入成功: " << filename << std::endl;
    }
    
    // 读取文本文件
    static void readTextFile(const std::string& filename) {
        std::ifstream file(filename);
        if (!file) {
            std::cout << "文件打开失败: " << filename << std::endl;
            return;
        }
        
        std::string line;
        std::cout << "文件内容: " << std::endl;
        while (std::getline(file, line)) {
            std::cout << line << std::endl;
        }
        file.close();
    }
    
    // 追加内容到文件
    static void appendToFile(const std::string& filename, const std::string& content) {
        std::ofstream file(filename, std::ios::app);  // append模式
        if (!file) {
            std::cout << "文件打开失败: " << filename << std::endl;
            return;
        }
        
        file << content << std::endl;
        file.close();
        std::cout << "内容追加成功: " << filename << std::endl;
    }
    
    // 二进制文件写入
    static void writeBinaryFile(const std::string& filename, const std::vector<int>& data) {
        std::ofstream file(filename, std::ios::binary);
        if (!file) {
            std::cout << "二进制文件创建失败: " << filename << std::endl;
            return;
        }
        
        file.write(reinterpret_cast<const char*>(data.data()), 
                   data.size() * sizeof(int));
        file.close();
        std::cout << "二进制文件写入成功: " << filename << std::endl;
    }
    
    // 二进制文件读取
    static std::vector<int> readBinaryFile(const std::string& filename) {
        std::ifstream file(filename, std::ios::binary);
        if (!file) {
            std::cout << "二进制文件打开失败: " << filename << std::endl;
            return {};
        }
        
        // 获取文件大小
        file.seekg(0, std::ios::end);
        size_t fileSize = file.tellg();
        file.seekg(0, std::ios::beg);
        
        std::vector<int> data(fileSize / sizeof(int));
        file.read(reinterpret_cast<char*>(data.data()), fileSize);
        file.close();
        
        std::cout << "二进制文件读取成功，读取了 " << data.size() << " 个整数" << std::endl;
        return data;
    }
    
    // 文件信息统计
    static void showFileInfo(const std::string& filename) {
        std::ifstream file(filename, std::ios::binary | std::ios::ate);
        if (!file) {
            std::cout << "文件打开失败: " << filename << std::endl;
            return;
        }
        
        size_t fileSize = file.tellg();
        file.close();
        
        std::cout << "文件信息: " << filename << std::endl;
        std::cout << "文件大小: " << fileSize << " 字节" << std::endl;
        std::cout << "文件大小: " << fileSize / 1024.0 << " KB" << std::endl;
    }
};

int main() {
    // 文本文件操作示例
    std::cout << "=== 文本文件操作 ===" << std::endl;
    FileHandler::writeTextFile("example.txt", "这是第一行文本\n这是第二行文本\n这是第三行文本");
    FileHandler::readTextFile("example.txt");
    FileHandler::appendToFile("example.txt", "这是追加的内容");
    FileHandler::readTextFile("example.txt");
    
    // 二进制文件操作示例
    std::cout << "\n=== 二进制文件操作 ===" << std::endl;
    std::vector<int> binaryData = {1, 2, 3, 4, 5, 10, 20, 30, 40, 50};
    FileHandler::writeBinaryFile("binary.dat", binaryData);
    
    auto readData = FileHandler::readBinaryFile("binary.dat");
    std::cout << "读取的数据: ";
    for (int num : readData) {
        std::cout << num << " ";
    }
    std::cout << std::endl;
    
    // 文件信息统计
    std::cout << "\n=== 文件信息统计 ===" << std::endl;
    FileHandler::showFileInfo("example.txt");
    FileHandler::showFileInfo("binary.dat");
    
    return 0;
}
```
- 注意事项：文件打开模式、错误处理、资源释放

## 3. 常见用法
- 场景1：配置文件读写
```cpp
#include <map>

class ConfigFileHandler {
public:
    static std::map<std::string, std::string> readConfig(const std::string& filename) {
        std::map<std::string, std::string> config;
        std::ifstream file(filename);
        
        if (!file) {
            std::cout << "配置文件打开失败: " << filename << std::endl;
            return config;
        }
        
        std::string line;
        while (std::getline(file, line)) {
            size_t pos = line.find('=');
            if (pos != std::string::npos) {
                std::string key = line.substr(0, pos);
                std::string value = line.substr(pos + 1);
                config[key] = value;
            }
        }
        file.close();
        return config;
    }
    
    static void writeConfig(const std::string& filename, 
                           const std::map<std::string, std::string>& config) {
        std::ofstream file(filename);
        if (!file) {
            std::cout << "配置文件创建失败: " << filename << std::endl;
            return;
        }
        
        for (const auto& pair : config) {
            file << pair.first << "=" << pair.second << std::endl;
        }
        file.close();
    }
};
```

- 场景2：日志文件记录
```cpp
#include <chrono>
#include <iomanip>

class Logger {
private:
    std::string logFile;
    
public:
    Logger(const std::string& filename) : logFile(filename) {}
    
    void log(const std::string& message, const std::string& level = "INFO") {
        auto now = std::chrono::system_clock::now();
        auto time = std::chrono::system_clock::to_time_t(now);
        
        std::ofstream file(logFile, std::ios::app);
        if (!file) return;
        
        file << std::put_time(std::localtime(&time), "%Y-%m-%d %H:%M:%S");
        file << " [" << level << "] " << message << std::endl;
        file.close();
    }
};
```

## 4. 易错点/坑
- 错误示例：
```cpp
// 不检查文件是否成功打开
std::ofstream file("data.txt");
file << "重要数据";  // 如果文件打开失败，数据丢失
```
- 原因：缺乏错误检查机制
- 修正方案：始终检查文件流状态

- 错误示例：
```cpp
// 二进制文件读取时大小计算错误
int data[10];
file.read(reinterpret_cast<char*>(data), 10);  // 错误：应该是sizeof(int)*10
```
- 原因：字节数计算错误
- 修正方案：使用sizeof计算正确字节数

## 5. 拓展补充
- 关联知识点：流操作、异常处理、内存管理、字符串处理
- 进阶延伸：XML/JSON解析、数据库文件操作、网络文件传输、压缩文件处理