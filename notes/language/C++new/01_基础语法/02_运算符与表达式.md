# 运算符与表达式

## 1. 核心概念

### 定义
- **运算符**：用于执行特定操作的符号
- **表达式**：由运算符和操作数组成的计算式
- **操作数**：运算符作用的对象

### 关键特性
- **优先级**：决定运算符的执行顺序
- **结合性**：相同优先级运算符的计算方向
- **副作用**：表达式可能改变操作数的值

## 2. 语法规则
### 基本语法
```cpp
操作数1 运算符 操作数2  // 二元运算符
运算符 操作数          // 一元运算符
操作数 运算符          // 后缀运算符
```

### 代码示例                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
```cpp
#include <iostream>
using namespace std;

int main() {
    // 算术运算符
    int a = 10, b = 3;
    cout << "a + b = " << (a + b) << endl;  // 13
    cout << "a - b = " << (a - b) << endl;  // 7
    cout << "a * b = " << (a * b) << endl;  // 30
    cout << "a / b = " << (a / b) << endl;  // 3 (整数除法)
    cout << "a % b = " << (a % b) << endl;  // 1 (取模)
    
    // 关系运算符
    cout << "a > b: " << (a > b) << endl;   // 1 (true)
    cout << "a == b: " << (a == b) << endl; // 0 (false)
    cout << "a != b: " << (a != b) << endl; // 1 (true)
    
    // 逻辑运算符
    bool x = true, y = false;
    cout << "x && y: " << (x && y) << endl; // 0 (false)
    cout << "x || y: " << (x || y) << endl; // 1 (true)
    cout << "!x: " << (!x) << endl;         // 0 (false)
    
    return 0;
}
```

### 注意事项
- 注意运算符的优先级和结合性
- 整数除法会截断小数部分
- 取模运算要求操作数为整数
- 避免除数为0的情况

## 3. 常见用法

### 场景1：复合赋值运算符
```cpp
int count = 0;
count += 5;     // count = count + 5
count -= 2;     // count = count - 2
count *= 3;     // count = count * 3
count /= 2;     // count = count / 2
count %= 3;     // count = count % 3

cout << "最终计数: " << count << endl;
```

### 场景2：自增自减运算符
```cpp
int i = 5;
// 前缀自增：先加1，再使用
cout << "++i: " << ++i << endl;  // 输出6，i现在为6

// 后缀自增：先使用，再加1
cout << "i++: " << i++ << endl;  // 输出6，i现在为7
cout << "当前i: " << i << endl;   // 输出7

// 类似地，前缀和后缀自减
int j = 10;
cout << "--j: " << --j << endl;  // 输出9
cout << "j--: " << j-- << endl;  // 输出9，j现在为8
```

### 场景3：条件运算符（三元运算符）
```cpp
int score = 85;
string result = (score >= 60) ? "及格" : "不及格";
cout << "成绩结果: " << result << endl;

// 嵌套条件运算符
int a = 10, b = 20, c = 15;
int max = (a > b) ? (a > c ? a : c) : (b > c ? b : c);
cout << "最大值: " << max << endl;
```

## 4. 易错点/坑

### 错误示例1：运算符优先级混淆
```cpp
int result = 2 + 3 * 4;  // 期望14，实际得到14
cout << result << endl;   // 正确，但可能混淆

// 更易混淆的情况
int a = 5, b = 3, c = 2;
int confusing = a + b * c;  // 5 + 3*2 = 11
cout << confusing << endl;
```
**原因**：乘法优先级高于加法
**修正方案**：
```cpp
// 使用括号明确优先级
int clear = (2 + 3) * 4;  // 5*4=20
cout << clear << endl;

int a = 5, b = 3, c = 2;
int clear2 = (a + b) * c;  // 8*2=16
cout << clear2 << endl;
```

### 错误示例2：整数溢出
```cpp
int big = 2000000000;
big = big * 2;  // 溢出
cout << big << endl;  // 输出错误结果
```
**原因**：超出int类型表示范围
**修正方案**：
```cpp
long long big = 2000000000LL;
big = big * 2;  // 使用更大的数据类型
cout << big << endl;
```

### 错误示例3：浮点数精度问题
```cpp
double d1 = 0.1;
double d2 = 0.2;
double sum = d1 + d2;
cout << "0.1 + 0.2 = " << sum << endl;  // 可能不是0.3
cout << "相等吗? " << (sum == 0.3) << endl;  // 可能为0
```
**原因**：浮点数二进制表示存在精度误差
**修正方案**：
```cpp
double d1 = 0.1;
double d2 = 0.2;
double sum = d1 + d2;
// 使用容差比较
if (abs(sum - 0.3) < 1e-10) {
    cout << "在容差范围内相等" << endl;
}
```

## 5. 拓展补充

### 关联知识点
- **类型转换**：操作数类型不同时的自动转换
- **位运算符**：对二进制位进行操作
- **逗号运算符**：顺序求值
- **sizeof运算符**：获取数据类型或对象的大小

### 进阶延伸
- **运算符重载**：自定义类类型的运算符行为
- **移动语义**：C++11引入的高效运算
- **constexpr**：编译时计算的表达式
- **lambda表达式**：匿名函数表达式